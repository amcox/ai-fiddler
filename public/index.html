<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Assessment Index Demo</title>

    <!-- Tangle -->
    <script type="text/javascript" src="/js/Tangle.js"></script>

    <!-- TangleKit (optional) -->
    <link rel="stylesheet" href="css/TangleKit.css" type="text/css">
    <link rel="stylesheet" href="css/ai-fiddler.css" type="text/css">
    <script type="text/javascript" src="/js/mootools.js"></script>
    <script type="text/javascript" src="/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="/js/sprintf.js"></script>
    <script type="text/javascript" src="/js/BVTouchable.js"></script>
    <script type="text/javascript" src="/js/TangleKit.js"></script>
    <script type="text/javascript" src="/js/ai-fiddler.js"></script>

    <!-- example -->
    <script type="text/javascript">

        function setUpTangle () {

            var element = document.getElementById("ai");
            var tangle = new Tangle(element, {
                initialize: function () {
                    this.adv_e = 1;
                    this.mast_e = 6;
                    this.basic_e = 36;
                    this.ab_e = 32;
                    this.unsat_e = 25;
                    this.total_e = this.adv_e+this.mast_e+this.basic_e+this.ab_e+this.unsat_e;
                    this.adv_m = 1;
                    this.mast_m = 7;
                    this.basic_m = 42;
                    this.ab_m = 25;
                    this.unsat_m = 25;
                    this.total_m = this.adv_m+this.mast_m+this.basic_m+this.ab_m+this.unsat_m;
                    this.adv_sc = 0;
                    this.mast_sc = 7;
                    this.basic_sc = 34;
                    this.ab_sc = 38;
                    this.unsat_sc = 21;
                    this.total_sc = this.adv_sc+this.mast_sc+this.basic_sc+this.ab_sc+this.unsat_sc;
                    this.adv_ss = 1;
                    this.mast_ss = 8;
                    this.basic_ss = 37;
                    this.ab_ss = 29;
                    this.unsat_ss = 25;
                    this.total_ss = this.adv_ss+this.mast_ss+this.basic_ss+this.ab_ss+this.unsat_ss;
                    this.bonus = 10;
                    resetMax = function(subject, tang){
                      var levels = ["adv", "mast", "basic", "ab", "unsat"];
                      levels.each(function(level){
                          total_s = "total_" + subject
                          level_s = level + "_" + subject
                          new_max = 100 - (tang[total_s] - tang[level_s])
                          $("[data-var=" + level_s + "]").attr("data-max", new_max)
                      });
                    };
                    resetMax("e", this);
                    resetMax("m", this);
                    resetMax("sc", this);
                    resetMax("ss", this);
                },
                update: function () {
                    this.total_e = this.adv_e+this.mast_e+this.basic_e+this.ab_e+this.unsat_e;
                    this.ai_e = (this.adv_e*150 + this.mast_e*125 + this.basic_e*100)/this.total_e;
                    
                    this.total_m = this.adv_m+this.mast_m+this.basic_m+this.ab_m+this.unsat_m;
                    this.ai_m = (this.adv_m*150 + this.mast_m*125 + this.basic_m*100)/this.total_m;
                    
                    this.total_sc = this.adv_sc+this.mast_sc+this.basic_sc+this.ab_sc+this.unsat_sc;
                    this.ai_sc = (this.adv_sc*150 + this.mast_sc*125 + this.basic_sc*100)/this.total_sc;
                    
                    this.total_ss = this.adv_ss+this.mast_ss+this.basic_ss+this.ab_ss+this.unsat_ss;
                    this.ai_ss = (this.adv_ss*150 + this.mast_ss*125 + this.basic_ss*100)/this.total_ss;
                    
                    this.total_all = this.total_e + this.total_m + this.total_sc + this.total_ss;
                    this.ai_all = (this.ai_e*2 + this.ai_m*2 + this.ai_sc + this.ai_ss)/6;
                    
                    this.test_var = this["total_e"];
                    
                    resetMax = function(subject, tang){
                      var levels = ["adv", "mast", "basic", "ab", "unsat"];
                      levels.each(function(level){
                          total_s = "total_" + subject
                          level_s = level + "_" + subject
                          new_max = 100 - (tang[total_s] - tang[level_s])
                          $("[data-var=" + level_s + "]").attr("data-max", new_max)
                      });
                    };
                    resetMax("e", this);
                    resetMax("m", this);
                    resetMax("sc", this);
                    resetMax("ss", this);
                }
            });
        }
        $(document).ready(setUpTangle)
    </script>
</head>

<body>
    <div id="ai">
      <table>
        <thead>
          <tr>
            <th></th>
            <th>ELA</th>
            <th>Math</th>
            <th>Science</th>
            <th>Social Studies</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Advanced</td>
            <td><span data-var="adv_e" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
            <td><span data-var="adv_m" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
            <td><span data-var="adv_sc" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
            <td><span data-var="adv_ss" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
          </tr>
          <tr>
            <td>Mastery</td>
            <td><span data-var="mast_e" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
            <td><span data-var="mast_m" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
            <td><span data-var="mast_sc" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
            <td><span data-var="mast_ss" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
          </tr>
          <tr>
            <td>Basic</td>
            <td><span data-var="basic_e" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
            <td><span data-var="basic_m" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
            <td><span data-var="basic_sc" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
            <td><span data-var="basic_ss" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
          </tr>
          <tr>
            <td>Approaching Basic</td>
            <td><span data-var="ab_e" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
            <td><span data-var="ab_m" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
            <td><span data-var="ab_sc" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
            <td><span data-var="ab_ss" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
          </tr>
          <tr>
            <td>Unsatisfactory</td>
            <td><span data-var="unsat_e" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
            <td><span data-var="unsat_m" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
            <td><span data-var="unsat_sc" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
            <td><span data-var="unsat_ss" class="TKAdjustableNumber " data-min="0" data-max="100">%</span></td>
          </tr>
          <tr>
            <td>Total</td>
            <td><span data-var="total_e" class="RedHundredPercent">%</span></td>
            <td><span data-var="total_m">%</span></td>
            <td><span data-var="total_sc">%</span></td>
            <td><span data-var="total_ss">%</span></td>
          </tr>
          <tr>
            <td>Assessment Index</td>
            <td><span data-var="ai_e" data-format="%.1f"></span></td>
            <td><span data-var="ai_m" data-format="%.1f"></span></td>
            <td><span data-var="ai_sc" data-format="%.1f"></span></td>
            <td><span data-var="ai_ss" data-format="%.1f"></span></td>
          </tr>
        </tbody>
      </table>
      <p>
        Bonus Points: <span data-var="bonus" class="TKAdjustableNumber " data-min="0" data-max="10" data-step="0.1" data-format="%.1f"></span>
      </p>
      <div style="margin-bottom:80px;">
        <div style="position: relative;">
         <canvas id="ai_chart_background" width="600" height="75" 
           style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
         <canvas id="ai_chart_foreground" width="600" height="75" class="AIBar" data-var="ai_all bonus"
           style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
        </div>
      </div>
      <p>
      </p>
    </div>

</body>
</html>
